#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// Maximum sizes
#define MAX 50
#define TITLE_LEN 50

// ------------------ QUEUE (Issued Books) ------------------
typedef struct {
    char title[TITLE_LEN];
} Book;

typedef struct {
    Book books[MAX];
    int front, rear;
} Queue;

void initQueue(Queue *q) {
    q->front = q->rear = -1;
}

int isQueueFull(Queue *q) {
    return q->rear == MAX - 1;
}

int isQueueEmpty(Queue *q) {
    return q->front == -1 || q->front > q->rear;
}

void enqueue(Queue *q, char *title) {
    if (isQueueFull(q)) {
        printf("\nQueue is full! Cannot issue more books.\n");
        return;
    }
    if (q->front == -1) q->front = 0;
    strcpy(q->books[++q->rear].title, title);
    printf("\nBook \"%s\" issued successfully.\n", title);
}

void displayQueue(Queue *q) {
    if (isQueueEmpty(q)) {
        printf("\nNo issued books.\n");
        return;
    }
    printf("\n--- Issued Books Queue ---\n");
    for (int i = q->front; i <= q->rear; i++)
        printf("%d. %s\n", i - q->front + 1, q->books[i].title);
}

// ------------------ STACK (Returned Books) ------------------
typedef struct {
    Book books[MAX];
    int top;
} Stack;

void initStack(Stack *s) {
    s->top = -1;
}

int isStackFull(Stack *s) {
    return s->top == MAX - 1;
}

int isStackEmpty(Stack *s) {
    return s->top == -1;
}

void push(Stack *s, char *title) {
    if (isStackFull(s)) {
        printf("\nStack is full! Cannot return more books.\n");
        return;
    }
    strcpy(s->books[++s->top].title, title);
    printf("\nBook \"%s\" returned successfully.\n", title);
}

void displayStack(Stack *s) {
    if (isStackEmpty(s)) {
        printf("\nNo returned books.\n");
        return;
    }
    printf("\n--- Returned Books Stack (Most Recent First) ---\n");
    for (int i = s->top; i >= 0; i--)
        printf("%d. %s\n", s->top - i + 1, s->books[i].title);
}

// ------------------ MAIN LIBRARY SYSTEM ------------------
void menu() {
    printf("\n============================");
    printf("\n   LIBRARY MANAGEMENT MENU  ");
    printf("\n============================");
    printf("\n1. Issue Book");
    printf("\n2. Return Book");
    printf("\n3. View Issued Books (Queue)");
    printf("\n4. View Returned Books (Stack)");
    printf("\n5. Exit");
    printf("\nEnter your choice: ");
}

int main() {
    Queue issued;
    Stack returned;
    char title[TITLE_LEN];
    int choice;

    initQueue(&issued);
    initStack(&returned);

    do {
        menu();
        scanf("%d", &choice);
        getchar(); // consume newline

        switch (choice) {
            case 1:
                printf("\nEnter book title to issue: ");
                fgets(title, TITLE_LEN, stdin);
                title[strcspn(title, "\n")] = '\0'; // remove newline
                enqueue(&issued, title);
                break;

            case 2:
                printf("\nEnter book title to return: ");
                fgets(title, TITLE_LEN, stdin);
                title[strcspn(title, "\n")] = '\0';
                push(&returned, title);
                break;

            case 3:
                displayQueue(&issued);
                break;

            case 4:
                displayStack(&returned);
                break;

            case 5:
                printf("\nExiting Library System. Goodbye!\n");
                break;

            default:
                printf("\nInvalid choice! Please try again.\n");
        }
    } while (choice != 5);

    return 0;
}
